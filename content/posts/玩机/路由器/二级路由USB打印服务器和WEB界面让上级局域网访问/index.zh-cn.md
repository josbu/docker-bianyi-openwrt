---
date: 2024-01-28T00:31:43+08:00
lastmod: 2024-01-28T00:31:43+08:00
categories:
  - 玩机
  - 路由器
title: 二级路由USB打印服务器和WEB界面让上级局域网访问
draft: "false"
tags:
  - 打印机
series:
---
## 开启打印服务
20元左右买一个带USB接口的路由器，刷好带usb打印服务器的openwrt固件，使USB连接到打印器。连接好后，在”检测到的打印机”一栏中会列出具体的型号。在"绑定"->"设备"中，**点击下拉栏选择你的打印机** ，如果不选择则无法打印，然后点击”保存&应用“。
![](Pasted%20image%2020240128003423.png)

查看路由器的IP地址
![](Pasted%20image%2020240128003506.png)


## 使得打印机可以让上级路由访问

此时直连该openwrt路由器可以直接通过192.168.31.88连接，但是上级路由器不行，因为默认情况下WAN口都是禁止访问的，因此我们需要添加一条防火墙，找到`网络->防火墙->自定义规则`，添加一行

```
iptables -I INPUT -p tcp --dport 9100 -j ACCEPT
```


![](Pasted%20image%2020240128003731.png)
这条命令的意思是：

- `-I INPUT`：向INPUT链添加规则。
- `-p tcp`：指定协议类型为TCP。
- `--dport 9100`：指定目标端口为9100。
- `-j ACCEPT`：满足以上条件的数据包被接收。

`-A`是指往后面插入，但是通常iptables的INPUT第一条规则是DROP，即丢包，第一条生效后，后面的ACCEPT规则就失效了，因此我们使用`-I`插入到第一条规则上面，也就是优先执行我们插入的规则。


## Windows连接网络打印机
蓝牙和设备->设备与打印机-> 添加打印机->打印机不在列表中
![](Pasted%20image%2020240128004719.png)

通过IP添加打印机

![](Pasted%20image%2020240128004808.png)

设备类型：TCP/IP 设备，ip地址填入到第二栏即可，第三栏会自动补充

![](Pasted%20image%2020240128004857.png)


1分钟左右的等待
![](Pasted%20image%2020240128004940.png)

选择自定义，输入打印机IP地址，其他默认，点击OK->next
![](Pasted%20image%2020240128005103.png)

又是一段时间的等待，然后选择你的打印机驱动，这个驱动是你之前安装过的，没有就搜索自己的打印机型号搜索，或者先用电脑有线连接一次打印机，让Windows自动下载驱动。
![](Pasted%20image%2020240128005253.png)


选择使用当前已经安装的驱动，而不是替换
![](Pasted%20image%2020240128005414.png)


参考： https://zhuanlan.zhihu.com/p/139772672
